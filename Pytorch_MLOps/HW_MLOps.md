# Домашнее задание 3. Train / Deploy / Attack / Repeat

## Задание 1: математическая разминка

В этом задании предлагается посчитать первые и вторые производные следующих функций:

1) f(x) = 3x^4 + 2x^3 - 5x^2 + 7x - 6
2) g(x, y, z) = x^2 + y^2 - z^3
3) k(x) = |x|

Посчитайте производные самостоятельно и с помощью `Torch.autograd`. 
В решении задания подробно опишите расчеты, а также код для расчетов с помощью `Torch.autograd`.

Оценка -- 10 баллов.

## Задание 2. Разработка и деплой модели

### Данные: [Imagenet](https://pytorch.org/vision/stable/generated/torchvision.datasets.ImageNet.html)
### Задачи: 

1. Разработка устойчивой модели -- 8 / 10 баллов

Разработайте модель, которая будет классифицировать изображения. Для обучения используйте датасет Imagenet. Можно использовать не весь датасет, а только его часть.
Слои для модели выбирайте на свой вкус, но не усложняйте. 

1) Напишите код полного цикла обучения модели на обычном `Pytorch`. Опишите саму модель, подгрузку датасета и обучение.
2) Перенесите модель на `Lightning`. Опишите, сильно ли изменился первоначальный код вашей модели. Получилось ли с помощью `Lightning` сократить объем кода и ускорить обучение модели.
3) Подбор гиперпараметров -- 5 баллов Перенесите `Lightning` модель в `Ray Tune`. Определите, какие гиперпараметры вы хотите подобрать.  С помощью `Ray Tune` выведите лучшие значения гиперпараметров для вашей модели. Используйте разные алгоритмы оптимизации гиперпараметров, которые есть в `Ray Tune`.
4) Используя модуль для состязательных атак (`advertorch`, `torchattacks` или `FoolBox`), организуйте атаку на вашу модель. Опишите выбранный метод атаки, а также сравните, влияет ли значение подобранных вами гиперпараметров на устойчивость модели.


3. Деплой модели -- 8 / 10 баллов.

Используя Ray Serve, напишите приложение, реализующее API, позволяющий использовать вашу модель.

1) В самом простом варианте API должен получать на вход картинку, а в качестве результата возвращать класс и вероятность принадлежности к нему.
2) Попробуйте разнообразить данные, которые можно подать API: помимо картинки подавайте `np.array`, `pd.DataFrame`.
3) Распараллельте ваш API, чтобы он мог обрабатывать несколько запросов за раз.


Доп. баллы -- организуйте интерфейс для вашего приложения, используя знания из дз по разметке. Используйте `Ray Serve` и `Gradio`.
